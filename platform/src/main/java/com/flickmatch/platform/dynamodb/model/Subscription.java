package com.flickmatch.platform.dynamodb.model;

import com.amazonaws.services.dynamodbv2.datamodeling.*;
import lombok.*;
import org.springframework.data.annotation.Id;


@DynamoDBTable(tableName="Subscription")
@Builder
@AllArgsConstructor
@NoArgsConstructor
@Data
@Getter
@Setter
public class Subscription {

    @DynamoDBHashKey(attributeName="userId")
    public String getUserId() {
        return this.subscriptionKey != null ? this.subscriptionKey.getUserId() : null;
    }

    public void setUserId(String userId) {
        if (this.subscriptionKey == null) {
            this.subscriptionKey = new SubscriptionKey();
        }
        this.subscriptionKey.setUserId(userId);
    }

    @DynamoDBRangeKey(attributeName = "subscriptionId")
    @DynamoDBAutoGeneratedKey
    public String getSubscriptionId() {
        return this.subscriptionKey != null ? this.subscriptionKey.getSubscriptionId() : null;
    }

    public void setSubscriptionId(String subscriptionId) {
        if (this.subscriptionKey == null) {
            this.subscriptionKey = new SubscriptionKey();
        }
        this.subscriptionKey.setSubscriptionId(subscriptionId);
    }



    private String status;

    private String passId;

    private Integer gamesLeft;

    private String expiryDate;

    // This is a composite key made up of userId and subscriptionId
    @Id
    private SubscriptionKey subscriptionKey;

    @Builder
    @Getter
    @Setter
    public static class SubscriptionKey {

        @DynamoDBHashKey(attributeName="userId")
        private String userId;

        @DynamoDBRangeKey(attributeName = "subscriptionId")
        @DynamoDBAutoGeneratedKey
        private String subscriptionId;

        SubscriptionKey() {
        }

        SubscriptionKey(String userId, String subscriptionId) {
            this.userId = userId;
            this.subscriptionId = subscriptionId;
        }
    }

}
